---
title: "Variance comparison"
author: "J. Hamski"
date: "4/20/2017"
output: html_document
---

```{r}
library(changepoint)
library(zoo)
library(tseries)
library(dplyr)
library(ggplot2)
library(knitr)

load("wti_project.Rda")
```



```{r}

wti.ts <- zoo(wti$wti, order.by=as.Date(as.character(wti$day), format='%m/%d/%y')) %>%
  as.ts() %>%
  na.remove()
```

```{r}
cpt.1 = cpt.mean(wti.ts, method="PELT", penalty = "Manual", pen.value = 10000, minseglen = 250)

#cpt.1 = cpt.mean(wti.ts, method="PELT", penalty = "SIC", minseglen = 250)

length(cpt.1@cpts)
plot(cpt.1)
```

```{r}
regimes <- cpt.1@cpts
regime.index <- NULL

for (i in 1:length(regimes)){
  ifelse(i == 1, 
         regime.index.iter <- rep.int(i, times = length(1:regimes[i])), 
         regime.index.iter <- rep.int(i, times = length((regimes[i-1]+1):regimes[i])))
  regime.index <- c(regime.index, regime.index.iter)
}

wti.regimes <- cbind(wti.ts, regime.index) %>% as.data.frame()
colnames(wti.regimes) <- c("close", "regime")
wti.regimes$regime <- as.factor(wti.regimes$regime)
```

```{r}
price.regime.descriptive <- wti.regimes %>%
  group_by(regime) %>% 
  summarize(ave = mean(close), var = var(close))

plot(x = price.regime.descriptive$ave, y = price.regime.descriptive$var, type = "p")
summary(lm(var ~ ave, data = price.regime.descriptive))
kable(price.regime.descriptive)
```

```{r}
ggplot(wti.regimes, aes(sample = close)) + stat_qq() + facet_grid(regime ~ .)
ggplot(wti.regimes, aes(x = regime, y = close)) + geom_violin() #+ geom_boxplot() 
```
https://en.wikipedia.org/wiki/F-test_of_equality_of_variances





